<!DOCTYPE HTML>
<html>
<head><meta http-equiv="refresh" content="2;url=https://opensource.adobe.com/dc-acrobat-sdk-docs/pdflsdk/" /><meta name="robots" content="noindex, nofollow">

 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
 <title>Adding 3D data to an annotation</title>

 

 <link rel="stylesheet" href="Creating_3D_Annotations.css" />
 <link rel="stylesheet" href="../../HTMLStyling.css" />


 <script type="text/javascript" language="JavaScript">
//<![CDATA[
function reDo() {
  if (innerWidth != origWidth || innerHeight != origHeight)
     location.reload();
}
if ((parseInt(navigator.appVersion) == 4) && (navigator.appName == "Netscape")) {
	origWidth = innerWidth;
	origHeight = innerHeight;
	onresize = reDo;
}
onerror = null; 
//]]>
</script>
<style type="text/css">
<!--
div.WebHelpPopupMenu { position:absolute;
left:0px;
top:0px;
z-index:4;
visibility:hidden; }
p.WebHelpNavBar { text-align:right; }
-->
</style>
 <meta name="generator" content="Adobe FrameMaker 2017" />
<script type="text/javascript" src="../../template/scripts/rh.min.js"></script>
<script type="text/javascript" src="../../template/scripts/common.min.js"></script>
<script type="text/javascript" src="../../template/scripts/topic.min.js"></script>
<script type="text/javascript" src="../../template/scripts/constants.js"></script>
<script type="text/javascript" src="../../template/scripts/utils.js"></script>
<script type="text/javascript" src="../../template/scripts/mhutils.js"></script>
<script type="text/javascript" src="../../template/scripts/mhlang.js"></script>
<script type="text/javascript" src="../../template/scripts/mhver.js"></script>
<script type="text/javascript" src="../../template/scripts/settings.js"></script>
<script type="text/javascript" src="../../template/scripts/XmlJsReader.js"></script>
<script type="text/javascript" src="../../template/scripts/loadparentdata.js"></script>
<script type="text/javascript" src="../../template/scripts/loadscreen.js"></script>
<script type="text/javascript" src="../../template/scripts/loadprojdata.js"></script>
<script type="text/javascript" src="../../template/scripts/mhtopic.js"></script>
 <link rel="stylesheet" type="text/css" href="../../template/styles/topic.min.css">
<script type="text/javascript" >
gRootRelPath = "../..";
gCommonRootRelPath = "../..";
gTopicId = "3.15.1";
</script>
 <meta name="brsprev" value="PDFL_MasterBook/Creating_3D_Annotations/Creating_annotations1.htm">
 <meta name="brsnext" value="PDFL_MasterBook/Handling_Exceptions/Handling_Exceptions.htm">
 <meta name="topic-breadcrumbs" content="Developing Plug-ins and Applications > Creating 3D Annotations" />
</head>

<body dir="ltr">
<script type="text/javascript" src="../../ehlpdhtm.js"></script>

   
	<!-- Body place holder starts here-->
    <div dir="ltr">
  <p dir="ltr" class="FM_3Head"><a name="XREF_21047_Adding_3D_data_to"></a>Adding 3D data to an annotation</p>
  <p dir="ltr" class="FM_Body">The PDF Library API does not contain methods for working specifically with 3D annotations. To add entries to a 3D annotation dictionary, you must use Cos-level API methods. These methods enable you to create PDF objects of any type (see the <span data-name="Ref_DocPDF" data-val="PDF Reference" data-showval="TRUE" data-format="Ref_DocPDF"><span class="FM_Italic">PDF Reference</span></span><span class="FM_Italic"></span>) and to set their values. </p>
  <p dir="ltr" class="FM_Body">The Cos API uses two primary object types:</p>
  <p dir="ltr" class="FM_Bullet1"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span><span class="FM_Courier">CosDoc</span> represents an entire PDF document.</p>
  <p dir="ltr" class="FM_Bullet1"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span><span class="FM_Courier">CosObj</span>&#160;represents all other PDF objects: simple types like numbers and string values as well as complex types such as dictionaries, arrays, and streams. </p>
  <p dir="ltr" class="FM_Body">The API provides methods for creating and working with different object types. The creation methods are of the form <span class="FM_Courier">CosNew</span><span class="FM_CourierItalic">Object</span>, where <span class="FM_CourierItalic">Object</span>&#160;is the object being created: for example, <span class="FM_Courier">CosNewDict</span>, which creates a dictionary object, <span class="FM_Courier">CosNewBoolean</span>, and <span class="FM_Courier">CosNewStream</span>.</p>
  <p dir="ltr" class="FM_Body">The first two parameters for the <span class="FM_Courier">CosNew</span><span class="FM_CourierItalic">Object</span>&#160;methods (with the exception of <span class="FM_Courier">CosNewNull</span>, which takes no parameters) are these:</p>
  <p dir="ltr" class="FM_Bullet1"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>The <span class="FM_Courier">CosDoc</span> object that represents the current document.</p>
  <p dir="ltr" class="FM_Bullet1"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>A Boolean parameter that specifies whether the new object should be indirect. Indirect objects (see the <span data-name="Ref_DocPDF" data-val="PDF Reference" data-showval="TRUE" data-format="Ref_DocPDF"><span class="FM_Italic">PDF Reference</span></span><span class="FM_Italic"></span>) are given object numbers and can be referred to from more than one place in a PDF file. Direct objects are specified only where they are used and cannot be referred to from anywhere else.</p>
  <p dir="ltr" class="FM_Body">The remaining parameters vary depending on the object type:</p>
  <p dir="ltr" class="FM_Bullet1"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>For simple types, the third parameter specifies its value. For arrays and dictionaries, the third parameter specifies the number of elements.</p>
  <p dir="ltr" class="FM_Bullet1"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>For streams, there are several additional parameters. See the <span class="FM_HyperText"><a href="../../API_References/PDFL_API_Reference/index.html">PDF Library API Reference</a></span>&#160;for details on each method.</p>
  <p dir="ltr" class="FM_Body">The return value of these methods is the newly created object. In the API, this object is always a <span class="FM_Courier">CosObj</span>. That is, even though you call <span class="FM_Courier">CosNewDict</span>&#160;to create a dictionary object, and you use methods like <span class="FM_Courier">CosDictPut</span>&#160;to work with dictionary objects, there is not a formal object type called <span class="FM_Courier">CosDict</span>.</p>
  <p dir="ltr" class="FM_Body">If necessary, you can determine the type of a <span class="FM_Courier">CosObj</span>&#160;by calling the <span class="FM_Courier">CosObjGetType</span>&#160;method, which returns a constant (<span class="FM_Courier">CosNull</span>, <span class="FM_Courier">CosInteger</span>, <span class="FM_Courier">CosFixed</span>, <span class="FM_Courier">CosReal</span>, <span class="FM_Courier">CosBoolean</span>, <span class="FM_Courier">CosName</span>, <span class="FM_Courier">CosString</span>, <span class="FM_Courier">CosDict</span>, <span class="FM_Courier">CosArray</span>, or <span class="FM_Courier">CosStream</span>). </p>
  <p dir="ltr" class="FM_Body">Most of the code described here involves setting the entries of dictionaries (<span class="FM_Courier">CosObjs</span>&#160;of type <span class="FM_Courier">CosDict</span>). Dictionaries contain a number of key-value pairs, where the key is a <span class="FM_Italic">name object</span>&#160;and the value is any type of <span class="FM_Courier">CosObj</span>. </p>
  <p dir="ltr" class="FM_Body">There are several common methods that can be used, which differ only in how the keys are specified. The <span class="FM_Courier">CosDictPutKeyString</span>&#160;method (available in <span data-name="AcrobatProd" data-val="Acrobat" data-showval="TRUE" data-format="AcrobatProd">Acrobat</span>&#160;7.0 or later) allows the key to be specified as a string and is the recommended method, as in the following example:</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDictPutKeyString(theDict,&nbsp;&nbsp;&nbsp;// The dictionary</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>&quot;TheKey&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// The key: a string</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>theCosValue);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// The value: a CosObj</p>
  <p dir="ltr" class="FM_Body"><span class="FM_Courier">CosDictPut</span>&#160;requires the key to be specified as an <span class="FM_Courier">ASAtom</span>. <span class="FM_Courier">CosDictPutKey</span>&#160;requires the key to be a name object (a <span class="FM_Courier">CosObj</span>&#160;of type <span class="FM_Courier">CosName</span>). </p>
  <p dir="ltr" class="FM_4Head"><a name="TOC_Creating_the_3D"></a><a name="IX_3D_annotations_1"></a><a name="IX_3D_annotations"></a>Creating the 3D annotation dictionary entries</p>
  <p dir="ltr" class="FM_Body"><a name="IX_PDAnnotGetCotObj_method"></a>To work with annotations at the Cos level, you must get the Cos object corresponding to the <span class="FM_Courier">PDAnnot</span>&#160;object. To perform this task, invoke the <span class="FM_Courier">PDAnnotGetCotObj</span>&#160;method and pass the <span class="FM_Courier">PDAnnot</span>&#160;object, as shown in the following example:</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosObj cosAnnot = PDAnnotGetCosObj(theAnnot);</p>
  <p dir="ltr" class="FM_Body">Next, get the <span class="FM_Courier">CosDoc</span>&#160;object corresponding to the document by invoking the <span class="FM_Courier">CosObjGetDoc</span>&#160;method and passing the <span class="FM_Courier">CosObj</span> object, as shown in the following example:</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDoc cosDoc = CosObjGetDoc(cosAnnot);</p>
  <p dir="ltr" class="FM_Body">Two additional dictionary entries (which are not specific to 3D annotations)—the <span class="FM_Courier">P</span>&#160;(page) and <span class="FM_Courier">Contents</span>&#160;entries—can be set as follows:</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDictPutKeyString(cosAnnot, &quot;P&quot;, PDPageGetCosObj(pdPage));</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDictPutKeyString(cosAnnot, &quot;Contents&quot;, </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosNewString(cosDoc, false, &quot;3D Model&quot;, strlen(&quot;3D Model&quot;)));</p>
  <p dir="ltr" class="FM_Body">The following sections show how to set the dictionary entries that are specific to 3D annotations: (See Table 9.33 in the <span data-name="Ref_DocPDF" data-val="PDF Reference" data-showval="TRUE" data-format="Ref_DocPDF"><span class="FM_Italic">PDF Reference</span></span><span class="FM_Italic"></span>.)</p>
  <p dir="ltr" class="FM_Indent1"><span class="FM_CourierBold">3DD</span>: A 3D stream specifying the 3D content (See <a href="#XREF_14693_Specifying_the_3D"><span class="FM_HyperText">Specifying the 3D stream</span></a>.)</p>
  <p dir="ltr" class="FM_Indent1"><span class="FM_CourierBold">3DV</span>: The initial view of the 3D content (See <a href="#XREF_69581_Setting_the"><span class="FM_HyperText">Setting the default view</span></a>.)</p>
  <p dir="ltr" class="FM_Indent1"><span class="FM_CourierBold">3DA</span>: The activation dictionary (See <a href="#XREF_16449_Setting_the"><span class="FM_HyperText">Setting the activation dictionary</span></a>.)</p>
  <p dir="ltr" class="FM_4Head"><a name="TOC_Specifying_the_3D_stream"></a><a name="XREF_14693_Specifying_the_3D"></a>Specifying the 3D stream</p>
  <p dir="ltr" class="FM_Body">The <span class="FM_Courier">3DD</span>&#160;entry of the annotation dictionary specifies a <span class="FM_Italic">stream</span>&#160;containing the PRC or U3D data. Streams are PDF objects that can be thought of as having two parts, the stream data and an associated dictionary:</p>
  <p dir="ltr" class="FM_Bullet1"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>Stream data is the PRC or U3D data that represents the 3D content.</p>
  <p dir="ltr" class="FM_Bullet1"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>The associated dictionary (sometimes called the <span class="FM_Italic">attributes dictionary</span>) contains entries that specify information about the stream. Some entries are common to all stream dictionaries (see Table 3.4 in the <span data-name="Ref_DocPDF" data-val="PDF Reference" data-showval="TRUE" data-format="Ref_DocPDF"><span class="FM_Italic">PDF Reference</span></span><span class="FM_Italic"></span>). They include:</p>
  <p dir="ltr" class="FM_Bullet2"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span><span class="FM_CourierBold">Length</span> (required): The length of the stream data</p>
  <p dir="ltr" class="FM_Bullet2"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span><span class="FM_CourierBold">Filter</span>&#160;(optional): A compression filter that is applied to the data to reduce its size (there are also filters that do not compress data)</p>
  <p dir="ltr" class="FM_Indent1">Other entries are unique to 3D streams (see Table 9.35 in the <span data-name="Ref_DocPDF" data-val="PDF Reference" data-showval="TRUE" data-format="Ref_DocPDF"><span class="FM_Italic">PDF Reference</span></span><span class="FM_Italic"></span>). They include:</p>
  <p dir="ltr" class="FM_Bullet2"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span><span class="FM_CourierBold">Type</span>&#160;(optional): Must be <span class="FM_Courier">3D</span> if present.</p>
  <p dir="ltr" class="FM_Bullet2"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span><span class="FM_CourierBold">Subtype</span>&#160;(required): For PRC data, set this value to <span class="FM_Courier">PRC</span>; for U3D data, set this value to <span class="FM_Courier">U3D</span>.</p>
  <p dir="ltr" class="FM_Bullet2"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span><span class="FM_CourierBold">OnInstantiate</span>&#160;(optional): A JavaScript script to be executed when the 3D stream is read. (See <a href="#XREF_12859_Specifying"><span class="FM_HyperText">Specifying JavaScript code</span></a>.)</p>
  <p dir="ltr" class="FM_4Head"><a name="TOC_Creating_the_stream"></a>Creating the stream object</p>
  <p dir="ltr" class="FM_Body">You must create a Cos stream that is based on the file containing the PRC or U3D data (this file was created with 3D authoring software) in order to create a 3D annotation. A data stream can be a buffer in memory, a file, or an arbitrary user-written procedure. A stream is represented by an <span class="FM_Courier">ASStm</span>&#160;object, which must be converted into a Cos stream.</p>
  <p dir="ltr" class="FM_Body">To create a Cos stream that is based on the file that contains the PRC or U3D data, perform the following steps:</p>
  <p dir="ltr" class="FM_StepReset"><a name="IX_GetMacPath_method"></a><a name="IX_ASPathFromPlatformPath"></a><span style="padding-left: 66pt;" class="FMAutoNumber_1"></span>1.<span style="padding-left: 2pt;" class="FMAutoNumber_2"></span>Create an <span class="FM_Courier">ASPathName</span>&#160;object that represents the file that contains the PRC or U3D data by invoking the <span class="FM_Courier">ASPathFromPlatformPath</span>&#160;method and passing a character pointer that specifies the location of the file that contains the PRC or U3D data. If you are working on the Mac OS platform, invoke the <span class="FM_Courier">GetMacPath</span> method and pass a character pointer that specifies the file location.</p>
  <p dir="ltr" class="FM_Step"><span style="padding-left: 66pt;" class="FMAutoNumber_1"></span>2.<span style="padding-left: 2pt;" class="FMAutoNumber_2"></span>Declare an <span class="FM_Courier">ASFile</span>&#160;object. </p>
  <p dir="ltr" class="FM_Step"><a name="IX_ASFileSysOpenFile_method_1"></a><span style="padding-left: 66pt;" class="FMAutoNumber_1"></span>3.<span style="padding-left: 2pt;" class="FMAutoNumber_2"></span>Populate the <span class="FM_Courier">ASFile</span>&#160;object with the PRC or U3D data by invoking the <span class="FM_Courier">ASFileSysOpenFile</span>&#160;method and passing the following arguments:</p>
  <p dir="ltr" class="FM_Bullet2"><a name="IX_ASGetDefaultFileSys_4"></a><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>An <span class="FM_Courier">ASFileSys</span>&#160;object that represents the file system in which the PDF file is located. Invoke the <span class="FM_Courier">ASGetDefaultFileSys</span> method to get the default file system.</p>
  <p dir="ltr" class="FM_Bullet2"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>An <span class="FM_Courier">ASPathName</span>&#160;object that represents the path in which the file that contains the PRC or U3D data is located (pass the <span class="FM_Courier">ASPathName</span> object created in step 1).</p>
  <p dir="ltr" class="FM_Bullet2"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>An <span class="FM_Courier">ASFileMode</span>&#160;object that represents the mode in which to open the file. For example, specify <span class="FM_Courier">ASFILE_READ</span> to open the file in read mode.</p>
  <p dir="ltr" class="FM_Bullet2"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>The address of an <span class="FM_Courier">ASFile</span>&#160;object. The <span class="FM_Courier">ASFileSysOpenFile</span>&#160;method populates this argument using the file that was opened (file information is obtained from the <span class="FM_Courier">ASPathName</span> object).</p>
  <p dir="ltr" class="FM_Step"><a name="IX_ASFileStmRdOpen_method"></a><span style="padding-left: 66pt;" class="FMAutoNumber_1"></span>4.<span style="padding-left: 2pt;" class="FMAutoNumber_2"></span>Create an <span class="FM_Courier">ASStm</span>&#160;object by invoking the <span class="FM_Courier">ASFileStmRdOpen</span>&#160;method and passing the following arguments:</p>
  <p dir="ltr" class="FM_Bullet2"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>The <span class="FM_Courier">ASFile</span>&#160;object with the file that contains the PRC or U3D data.</p>
  <p dir="ltr" class="FM_Bullet2"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>Length of data buffer, in bytes. If you specify <span class="FM_Courier">0</span>, then the default buffer size (currently 4kB) is used.</p>
  <p dir="ltr" class="FM_Step"><a name="IX_CosNewStream_method_1"></a><span style="padding-left: 66pt;" class="FMAutoNumber_1"></span>5.<span style="padding-left: 2pt;" class="FMAutoNumber_2"></span>Invoke the <span class="FM_Courier">CosNewStream</span>&#160;method to create a Cos stream containing the data that is located within the <span class="FM_Courier">ASStm</span>&#160;object. This Cos stream will become the value of the 3DD entry of the 3D annotation. Pass the following arguments to this method:</p>
  <p dir="ltr" class="FM_Bullet2"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>A <span class="FM_Courier">CosDoc</span> object that specifies the PDF document in which the Cos stream is inserted.</p>
  <p dir="ltr" class="FM_Bullet2"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>An <span class="FM_Courier">ASBool</span>&#160;object that specifies whether the Cos stream is an indirect object. Because all streams are indirect objects, this argument must be set to <span class="FM_Courier">true</span>. </p>
  <p dir="ltr" class="FM_Bullet2"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>An <span class="FM_Courier">ASStm</span>&#160;object that contains the stream data (pass the <span class="FM_Courier">ASStm</span>&#160;object created in step 4). </p>
  <p dir="ltr" class="FM_Bullet2"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>A <span class="FM_Courier">CosStreamStartAndCode</span>&#160;object that specifies the byte offset from which data reading starts. You can pass <span class="FM_Courier">0</span>&#160;to ensure that data reading starts at the beginning of the stream. </p>
  <p dir="ltr" class="FM_Bullet2"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>An <span class="FM_Courier">ASBool</span>&#160;object that specifies whether the data is encoded using filters specified in the stream dictionary before it is written to the Cos stream.</p>
  <p dir="ltr" class="FM_Bullet2"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>A <span class="FM_Courier">CosObj</span>&#160;object that represents the stream dictionary. You can invoke the <span class="FM_Courier">CosNewNull</span> method.</p>
  <p dir="ltr" class="FM_Bullet2"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>A <span class="FM_Courier">CosObj</span>&#160;object that represents the parameters that are used by the encoding filter if the source data is encoded before it is written to the file. If encoding parameters are not required, this value is ignored. For information about encoding filters, see the <span data-name="Ref_DocPDF" data-val="PDF Reference" data-showval="TRUE" data-format="Ref_DocPDF"><span class="FM_Italic">PDF Reference</span></span><span class="FM_Italic"></span>. </p>
  <p dir="ltr" class="FM_Bullet2"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>A <span class="FM_Courier">CosByteMax</span>&#160;object that specifies the amount of data read from the source. If this value is <span class="FM_Courier">-1</span>, data is read from the source until it reaches the end of the stream.</p>
  <p dir="ltr" class="FM_Body">The <span class="FM_Courier">CosNewStream</span>&#160;method returns a <span class="FM_Courier">CosObj</span>&#160;object that represents the Cos stream. The following code example creates a Cos stream. </p>
  <p dir="ltr" class="FM_CodeComment"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>//Create an ASPathName that specifies the location of the.U3D file</p>
  <p dir="ltr" class="FM_CodeComment"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>//u3dFileName is a character pointer that specifies the path to this file</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>ASPathName u3DPathName = &#160;ASPathFromPlatformPath((void*) u3dFileName);</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span></p>
  <p dir="ltr" class="FM_CodeComment"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>//Create an ASFile object and populate it</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>ASFile asFile = NULL;</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>ASInt32 err = ASFileSysOpenFile(ASGetDefaultFileSys(), u3DPathName, <span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>ASFILE_READ, &amp;asFile);</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>ASFileSysReleasePath (ASGetDefaultFileSys(), u3DPathName);</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span></p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>if (asFile == NULL)</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>AVAlertNote(&quot;Error opening 3D data file.&quot;);</p>
  <p dir="ltr" class="FM_CodeReference">&nbsp;</p>
  <p dir="ltr" class="FM_CodeComment"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>//Read data stream from the file</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>ASStm fileStm = ASFileStmRdOpen(asFile, 0);</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>if (fileStm == NULL)</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>AVAlertNote(&quot;Empty 3D data stream.&quot;);</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span></p>
  <p dir="ltr" class="FM_CodeComment"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>//Create a new Cos stream and set it under 3DD key in the annot dictionary</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosObj stm3D = CosNewStream(cosDoc, true, fileStm, 0, false, CosNewNull(),</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosNewNull(), -1);</p>
  <p dir="ltr" class="FM_4Head"><a name="TOC_Adding_the_Cos_stream_to"></a>Adding the Cos stream to the annotation dictionary</p>
  <p dir="ltr" class="FM_Body">After you create a a <span class="FM_Courier">CosObj</span>&#160;object that represents the Cos stream, invoke the <span class="FM_Courier">CosDictPutKeyString</span>&#160;method to add the Cos stream as the value of the <span class="FM_Courier">3DD</span> entry of the annotation dictionary:</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDictPutKeyString(cosAnnot,&nbsp;&nbsp;&nbsp;// The annotation dictionary</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>&quot;3DD&quot;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// The key</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>stm3D);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// The <span class="FM_Courier">CosObj object used as the </span>value</p>
  <p dir="ltr" class="FM_4Head"><a name="TOC_Creating_the_attributes"></a><a name="XREF_26840_Creating_the"></a>Creating the attributes dictionary</p>
  <p dir="ltr" class="FM_Body">Complete the entries in the 3D stream dictionary. The <span class="FM_Courier">CosStreamDict</span>&#160;method obtains the Cos dictionary associated with the stream:</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosObj attrObj = CosStreamDict(stm3D);</p>
  <p dir="ltr" class="FM_Body">Next, entries can be added to the dictionary. The <span class="FM_Courier">Type</span>&#160;and <span class="FM_Courier">Subtype</span>&#160;entries both take name objects as values. Therefore, strings specified in the code must be explicitly converted to names:</p>
  <p dir="ltr" class="FM_CodeComment"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>//Set the stream's dictionary</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDictPutKeyString(attrObj, &quot;Subtype&quot;, CosNewName(cosDoc, false,</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>ASAtomFromString(&quot;U3D&quot;)));</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDictPutKeyString(attrObj, &quot;Type&quot;, CosNewNameFromString(cosDoc, false,</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>&quot;3D&quot;));</p>
  <p dir="ltr" class="FM_4Head"><a name="TOC_Specifying_JavaScript"></a><a name="XREF_12859_Specifying"></a>Specifying JavaScript code</p>
  <p dir="ltr" class="FM_Body">You can create JavaScript that manipulates the 3D annotation. JavaScript is optional and if you do not specify it, then the 3D annotation is still inserted into the PDF document; however, it remains a static graphic. For information about creating JavaScript that manipulates 3D annotations, see the <span data-name="Ref_Java3DAPI" data-val="JavaScript for Acrobat 3D Annotations API Reference" data-showval="TRUE" data-format="Ref_Java3DAPI"><span class="FM_Italic">JavaScript for Acrobat 3D Annotations API Reference</span></span><span class="FM_Italic"></span>.</p>
  <p dir="ltr" class="FM_Body">The following code example creates an <span class="FM_Courier">ASFile</span>&#160;object and populates it with the JavaScript file. The <span class="FM_Courier">JsFileName</span> variable is a character pointer that specifies the location of the JavaScript file.</p>
  <p dir="ltr" class="FM_CodeComment"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>//Create a char pointer that specifies the location of the JavaScript file</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>char*JsFileName = &quot;C:\\3DJavaScript.js&quot;</p>
  <p dir="ltr" class="FM_CodeReference">&nbsp;</p>
  <p dir="ltr" class="FM_CodeComment"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>//Declare an ASFile object that will reference the JavaScript file</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>ASFile jsFile = NULL;</p>
  <p dir="ltr" class="FM_CodeReference">&nbsp;</p>
  <p dir="ltr" class="FM_CodeComment"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>//Create an ASPathName object based on the JavaScript file</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>ASPathName JsPathName = &#160;ASPathFromPlatformPath((void*) JsFileName);</p>
  <p dir="ltr" class="FM_CodeReference">&nbsp;</p>
  <p dir="ltr" class="FM_CodeComment"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>//Populate the ASFile object </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>if(JsPathName)</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>ASInt32 err1 = ASFileSysOpenFile(ASGetDefaultFileSys(), JsPathName,</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>ASFILE_READ, &amp;jsFile);</p>
  <p dir="ltr" class="FM_Body">Next, the data from the file is read into a stream:</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>ASStm JsFileStm = ASFileStmRdOpen(jsFile, 0);</p>
  <p dir="ltr" class="FM_Body">In the following code, an entry is added to the stream dictionary in the process of creating the stream, rather than afterwards as in the previous code. First, the <span class="FM_Courier">CosNewDict</span>&#160;method is used to create a new dictionary: </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosObj dictJsStm = CosNewDict(cosDoc, false, 1);</p>
  <p dir="ltr" class="FM_Body">This method requires three parameters:</p>
  <p dir="ltr" class="FM_Bullet1"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>The document in which the dictionary is used.</p>
  <p dir="ltr" class="FM_Bullet1"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>A Boolean value that specifies whether the dictionary should be an indirect object. All stream dictionaries must be direct; hence the value of this parameter is <span class="FM_Courier">false</span>. </p>
  <p dir="ltr" class="FM_Bullet1"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>A hint for the number of entries in the dictionary (however, dictionaries grow dynamically as needed).</p>
  <p dir="ltr" class="FM_Body">Next, the value of the <span class="FM_Courier">Filter</span>&#160;entry is set to <span class="FM_Courier">FlateDecode</span>&#160;using the <span class="FM_Courier">CosDictPutKeyString</span>&#160;method. This means that the stream will be compressed using Flate (ZIP) compression.</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDictPutKeyString(dictJsStm, &quot;Filter&quot;, </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosNewNameFromString(cosDoc, false, &quot;FlateDecode&quot;));</p>
  <p dir="ltr" class="FM_Body">Next, the Cos stream is created, using the stream data and attributes dictionary already created: </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>stm3Djscode = CosNewStream(cosDoc, true, </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>JsFileStm,&nbsp;&nbsp;&nbsp;&nbsp;//The stream</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>0, true, </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>dictJsStm,&nbsp;&nbsp;&nbsp;// The stream dictionary</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosNewNull(), -1);</p>
  <p dir="ltr" class="FM_Body">Set it as the value of the <span class="FM_Courier">OnInstantiate</span>&#160;entry of the 3D stream dictionary. The following code example specifies a JavaScript script as the value of the <span class="FM_Courier">OnInstantiate</span>&#160;entry of the 3D stream dictionary. </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDictPutKeyString(attrObj, &quot;OnInstantiate&quot;, stm3Djscode);</p>
  <p dir="ltr" class="FM_Body">Then some cleanup is done:</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>ASFileSysReleasePath (ASGetDefaultFileSys(), JsPathName);</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>ASStmClose(JsFileStm);</p>
  <p dir="ltr" class="FM_4Head"><a name="TOC_Setting_the_default_view"></a><a name="XREF_69581_Setting_the"></a>Setting the default view</p>
  <p dir="ltr" class="FM_Body">A 3D <span class="FM_Italic">view </span>specifies parameters such as position, orientation, and projection style, which are applied to the <span class="FM_Italic">virtual camera</span>&#160;associated with the 3D annotation (see section 9.5.3 in the <span data-name="Ref_DocPDF" data-val="PDF Reference" data-showval="TRUE" data-format="Ref_DocPDF"><span class="FM_Italic">PDF Reference</span></span><span class="FM_Italic"></span>). The <span class="FM_Italic">default view</span>&#160;is the view that is chosen when the annotation is activated.</p>
  <p dir="ltr" class="FM_Body">3D data typically contains a default initial view. This view is used by default if not otherwise specified. In addition, views can be specified by the entries in a view dictionary. </p>
  <p dir="ltr" class="FM_Body">The <span class="FM_Courier">VA</span>&#160;entry in the 3D stream dictionary is an array of view dictionaries. One of the views can be chosen as the default by means of the <span class="FM_Courier">3DV</span>&#160;entry in the 3D annotation dictionary or the <span class="FM_Courier">DV</span>&#160;entry in a 3D stream dictionary.</p>
  <p dir="ltr" class="FM_Body">The following code creates a view dictionary and specifies its entries. The code assumes the Cos objects <span class="FM_Courier">cosAnnot</span>&#160;for the annotation and <span class="FM_Courier">cosDoc</span>&#160;for the document have already been obtained. First, a view dictionary is created by invoking the <span class="FM_Courier">CosNewDict</span> method:</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosObj cosView = CosNewDict (cosDoc, true, 8);</p>
  <p dir="ltr" class="FM_Body">Next, the code sets the following entries: (See Table 9.39 in the <span data-name="Ref_DocPDF" data-val="PDF Reference" data-showval="TRUE" data-format="Ref_DocPDF"><span class="FM_Italic">PDF Reference</span></span><span class="FM_Italic"></span>&#160;for more detailed information.)</p>
  <p dir="ltr" class="FM_Indent1"><span class="FM_CourierBold">Type</span>&#160;(optional): If present, must be the name <span class="FM_Courier">3DView</span>.</p>
  <p dir="ltr" class="FM_Indent1"><span class="FM_CourierBold">XN</span> (required): The name of the view, a string that can be displayed in the user interface.</p>
  <p dir="ltr" class="FM_Indent1"><span class="FM_CourierBold">IN</span>&#160;(optional): The internal name of the view, a string that can be used to refer to the view from other objects, such as in JavaScript code.</p>
  <p dir="ltr" class="FM_Indent1"><span class="FM_CourierBold">C2W</span>&#160;(optional): A transformation matrix specifying the camera position. To use this, it is also necessary to set the value of the <span class="FM_Courier">MS</span>&#160;entry to <span class="FM_Courier">M</span>.</p>
  <p dir="ltr" class="FM_Indent1"><span class="FM_CourierBold">CO</span> (optional): A number indicating the distance to the center of orbit for this view.</p>
  <p dir="ltr" class="FM_Body">The following code creates an array of type <span class="FM_Courier">double</span> and specifies values for views:</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>char* externalViewName = &quot;Default View&quot;;</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>char* internalViewName = &quot;Sample3dView&quot;;</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span></p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>double gMatrixVals[12] = </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>{1.0, 0.0, 0.0, 0.0, 0.0000000000000000612303, -1.0, </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>0.0, 1.0, 0.0000000000000000612303, 82.9517, -883.324, 115.166};</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>float gCOvalue = (float) 725.305;</p>
  <p dir="ltr" class="FM_Body">Now the values of the dictionary entries are set:</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDictPutKeyString(cosView, &quot;Type&quot;, </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosNewNameFromString(cosDoc, false,&quot;3DView&quot;));</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span></p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDictPutKeyString(cosView, &quot;XN&quot;, CosNewString(cosDoc, false, </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>externalViewName, strlen(externalViewName))); </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span></p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDictPutKeyString(cosView, &quot;IN&quot;, CosNewString(cosDoc, false, </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>internalViewName, strlen(internalViewName))); </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span></p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDictPutKeyString(cosView, &quot;MS&quot;, </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosNewNameFromString(cosDoc, false, &quot;M&quot;));</p>
  <p dir="ltr" class="FM_CodeReference">&nbsp;</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDictPutKeyString(cosView, &quot;CO&quot;, CosNewFixed(cosDoc, false,</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>FloatToASFixed(gCOvalue)));</p>
  <p dir="ltr" class="FM_Body">Here the <span class="FM_Courier">C2W</span> matrix is populated with the appropriate values:</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosObj matrixArray = CosNewArray(cosDoc, false, 12);</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>for(int i=0; i&lt;12; i++) </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosArrayPut(matrixArray, i, </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosNewFloat(cosDoc, false, (float) gMatrixVals[i]));</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDictPutKeyString(cosView, &quot;C2W&quot;, matrixArray);</p>
  <p dir="ltr" class="FM_Body">Last, the dictionary is set as the value of the <span class="FM_Courier">3DV</span>&#160;key in the annotation dictionary: </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDictPutKeyString(cosAnnot, &quot;3DV&quot;, cosView);</p>
  <p dir="ltr" class="FM_4Head"><a name="TOC_Setting_the_annotation"></a><a name="XREF_59797_Setting_the"></a>Setting the annotation appearance</p>
  <p dir="ltr" class="FM_Body">You may optionally provide a <span class="FM_Italic">poster</span>&#160;as the initial appearance of the annotation. The poster may be an image or other graphic content that is in a file or in memory. It must be converted to a PDF <span class="FM_Italic">form XObject</span>&#160;to be used as the annotation appearance (see section 4.9 of the <span data-name="Ref_DocPDF" data-val="PDF Reference" data-showval="TRUE" data-format="Ref_DocPDF"><span class="FM_Italic">PDF Reference</span></span><span class="FM_Italic"></span>).</p>
  <p dir="ltr" class="FM_Body">The <span class="FM_Courier">AP</span>&#160;entry of the annotation dictionary specifies an <span class="FM_Italic">appearance dictionary.</span>&#160;This dictionary contains one or more <span class="FM_Italic">appearance streams </span>(see section 8.4.4 of the <span data-name="Ref_DocPDF" data-val="PDF Reference" data-showval="TRUE" data-format="Ref_DocPDF"><span class="FM_Italic">PDF Reference</span></span><span class="FM_Italic"></span>) that are PDF content streams (form XObjects) rendered inside the annotation rectangle. </p>
  <p dir="ltr" class="FM_Body">For 3D annotations, the appearance stream is used in the following situations:</p>
  <p dir="ltr" class="FM_Bullet1"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>To provide an annotation appearance for PDF viewers that do not support 3D.</p>
  <p dir="ltr" class="FM_Bullet1"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>To provide an initial appearance for the annotation prior to activation. The settings in the activation dictionary determine whether this appearance is ever displayed.</p>
  <p dir="ltr" class="FM_Body">There are several ways to get the poster. The function described below, <span class="FM_Courier">GetFormXObjectFromFile</span>, illustrates one method. The appearance is generated from a separate PDF file containing an image or other content. You call this function as follows:</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosObj formXObject = GetFormXObjectFromFile</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>(gsPosterFilePath, //The external file</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>pdDoc);</p>
  <p dir="ltr" class="FM_Body">The function returns a Cos object, <span class="FM_Courier">formXObject</span>, which is the form XObject to be used as the appearance. </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosObj cosAnnot = PDAnnotGetCosObj(newAnnot);</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDoc cosDoc = CosObjGetDoc(cosAnnot);</p>
  <p dir="ltr" class="FM_Body">Then you create the appearance dictionary:</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosObj apprDict = CosNewDict(cosDoc, false, 1);</p>
  <p dir="ltr" class="FM_Body">and set its <span class="FM_Courier">N</span> (normal) entry to the appearance stream obtained above.</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDictPutKeyString(apprDict, &quot;N&quot;, formXObject);</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDictPutKeyString(cosAnnot, &quot;AP&quot;, apprDict);</p>
  <p dir="ltr" class="FM_Body">The following is the <span class="FM_Courier">GetFormXObjectFromFile</span> function:</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosObj GetFormXObjectFromFile</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>(char* pdfImageFilePath, //Path of image PDF file</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>PDDoc TargetPdDoc)<span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>// The current document</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>{</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>PDDoc posterPDFDoc = NULL;<span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>//Initialization code</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>PDPage pdPageImage = NULL;</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>ASPathName asPathName; </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosObj contentFormXObject = CosNewNull();</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosObj formXObject = CosNewNull();</p>
  <p dir="ltr" class="FM_Body">First, the PDF file containing the image is opened:</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>if(strlen(pdfImageFilePath) &gt; 0 ) {</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>char sPathFlag[16] = &quot;Cstring&quot;;</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>#ifdef MAC_PLATFORM</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>if (!strchr(pdfImageFilePath,(int)':'))</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>strcpy (sPathFlag, &quot;POSIXPath&quot;);</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>#endif</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span></p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>asPathName = ASFileSysCreatePathName (ASGetDefaultFileSys(),</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>ASAtomFromString(sPathFlag), pdfImageFilePath, 0);</p>
  <p dir="ltr" class="FM_Body">The content to be used is expected to be on the first page of the PDF file. The <span class="FM_Courier">PDDocAcquirePage</span>&#160;method returns a <span class="FM_Courier">PDPage</span> object for the first page.</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>pdPageImage = PDDocAcquirePage(posterPDFDoc, 0);</p>
  <p dir="ltr" class="FM_Body">The code then uses PDE-layer (PDFEdit) methods that work with the content streams on the PDF page. (See the <span data-name="Dev_Overview" data-val="Overview" data-showval="TRUE" data-format="Dev_Overview"><span class="FM_Italic">Overview</span></span><span class="FM_Italic"></span> guide for more information on how these methods work.)</p>
  <p dir="ltr" class="FM_Body">The <span class="FM_Courier">PDPageAcquirePDEContent</span>&#160;method returns a <span class="FM_Courier">PDEContent</span>&#160;object representing the page’s contents. The first parameter is the <span class="FM_Courier">PDPage</span>&#160;and the second identifies the caller: for PDF Library, it is zero; for plug-ins, it should be the <span class="FM_Courier">gExtensionID</span> extension:</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>PDEContent pdeContent = PDPageAcquirePDEContent (pdPageImage, 0);</p>
  <p dir="ltr" class="FM_Body">The <span class="FM_Courier">PDEContentGetAttrs</span>&#160;method gets information about the content in a <span class="FM_Courier">PDEContentAttrs</span>&#160;structure:</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>PDEContentAttrs pdeContentAttrs;</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>PDEContentGetAttrs</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>(pdeContent, &amp;pdeContentAttrs, sizeof(pdeContentAttrs));</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span></p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosObj contentResources = CosNewNull();</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDoc pdDocCos = PDDocGetCosDoc(posterPDFDoc);</p>
  <p dir="ltr" class="FM_Body">The <span class="FM_Courier">PDEContentToCosObj</span>&#160;method converts the <span class="FM_Courier">PDEContent</span>&#160;to a form XObject Cos object. </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>PDEContentToCosObj (pdeContent, </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>kPDEContentToForm,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// To Form XObject</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>&amp;pdeContentAttrs,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// PDEContentAttrsP</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>sizeof(pdeContentAttrs),&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// attrsSize,</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>pdDocCos,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// The CosDoc</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>NULL,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// PDEFilterArrayP</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>&amp;contentFormXObject,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Resulting form Cos object</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>&amp;contentResources);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Resulting resource Cos object </p>
  <p dir="ltr" class="FM_Body">The following are parameters to this method:</p>
  <p dir="ltr" class="FM_Bullet1"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>The <span class="FM_Courier">PDEContent</span> object.</p>
  <p dir="ltr" class="FM_Bullet1"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>A flag indicating what type of Cos object should be created; in this case, a form XObject.</p>
  <p dir="ltr" class="FM_Bullet1"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>The <span class="FM_Courier">PDEContentAttrs</span>&#160;structure containing information about the <span class="FM_Courier">PDEContent</span>.</p>
  <p dir="ltr" class="FM_Bullet1"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>The size of the <span class="FM_Courier">PDEContentAttrs</span> structure.</p>
  <p dir="ltr" class="FM_Bullet1"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>The Cos document.</p>
  <p dir="ltr" class="FM_Bullet1"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>A pointer indicating which filters to use to encode the contents (in this case, null).</p>
  <p dir="ltr" class="FM_Bullet1"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>The resulting Cos object (in this case, the form XObject which is the variable <span class="FM_Courier">contentFormXObject</span>).</p>
  <p dir="ltr" class="FM_Bullet1"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>The resulting Cos object representing the resources needed by the Cos object. These resources can include fonts and other items (see section 3.7.2 of the <span data-name="Ref_DocPDF" data-val="PDF Reference" data-showval="TRUE" data-format="Ref_DocPDF"><span class="FM_Italic">PDF Reference</span></span><span class="FM_Italic"></span>).</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span></p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>if (!CosObjEqual(contentFormXObject, CosNewNull()) &amp;&amp; &#160;</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>!CosObjEqual(contentResources, CosNewNull())) {</p>
  <p dir="ltr" class="FM_Body">The returned resources must be put into the form XObject’s <span class="FM_Courier">Resources</span> dictionary:</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDictPutKeyString(contentFormXObject, &quot;Resources&quot;, </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>contentResources);</p>
  <p dir="ltr" class="FM_Body">The <span class="FM_Courier">BBox</span> entry of the form XObject is required and is set to the value of the page’s media box:</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>ASFixedRect boundingBox; &#160;</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>PDPageGetMediaBox(pdPageImage, &amp;boundingBox);</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosObj BBoxArray = CosNewArray(pdDocCos, 4, false);</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosArrayPut(BBoxArray,0, CosNewInteger(pdDocCos, false,<br /><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>ASFixedRoundToInt16(boundingBox.left)));</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosArrayPut(BBoxArray,1, CosNewInteger(pdDocCos, false,<br /><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>ASFixedRoundToInt16(boundingBox.bottom)));</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosArrayPut(BBoxArray,2, CosNewInteger(pdDocCos, false,<br /><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>ASFixedRoundToInt16(boundingBox.right)));</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosArrayPut(BBoxArray,3, CosNewInteger(pdDocCos, false,<br /><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>ASFixedRoundToInt16(boundingBox.top)));</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDictPutKeyString(contentFormXObject, &quot;BBox&quot;, BBoxArray);</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>// Set matrix key in form object </p>
  <p dir="ltr" class="FM_Body">The <span class="FM_Courier">Matrix</span>&#160;entry of the form XObject is set to the values obtained from the page by means of the <span class="FM_Courier">PDPageGetDefaultMatrix</span> method:</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>ASFixedMatrix defaultMatrix;</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>PDPageGetDefaultMatrix(pdPageImage, &amp;defaultMatrix);</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosObj MatrixArray = CosNewArray(pdDocCos, 6, false);</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosArrayPut(MatrixArray,0, CosNewFixed(</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>pdDocCos, false, defaultMatrix.a));</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosArrayPut(MatrixArray,1, CosNewFixed</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>(pdDocCos, false, defaultMatrix.b));</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosArrayPut(MatrixArray,2, CosNewFixed</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>(pdDocCos, false, defaultMatrix.c));</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosArrayPut(MatrixArray,3, CosNewFixed</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>(pdDocCos, false, defaultMatrix.d));</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosArrayPut(MatrixArray,4, CosNewFixed</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>(pdDocCos, false, defaultMatrix.h));</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosArrayPut(MatrixArray,5, CosNewFixed</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>(pdDocCos, false, defaultMatrix.v));</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDictPutKeyString(contentFormXObject, &quot;Matrix&quot;, MatrixArray);</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>}</p>
  <p dir="ltr" class="FM_Body">Finally, the <span class="FM_Courier">CosObjCopy</span>&#160;method is used to copy the Cos object <span class="FM_Courier">contentFormXObject</span>&#160;into the current PDF document. The following are paremeters to this method:</p>
  <p dir="ltr" class="FM_Bullet1"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>The <span class="FM_Courier">CosObj</span> to copy.</p>
  <p dir="ltr" class="FM_Bullet1"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>The <span class="FM_Courier">CosDoc</span> for the document in which to copy it.</p>
  <p dir="ltr" class="FM_Bullet1"><span class="FM_Z_Bullet">•<span style="padding-left: 12pt;" class="FMAutoNumber_1"></span></span>A Boolean value: tru<span class="FM_Courier">e</span>&#160;means that all indirectly referenced objects from the source should be copied to the destination.</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>formXObject = CosObjCopy (contentFormXObject, </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>PDDocGetCosDoc(TargetPdDoc), true); &#160;</p>
  <p dir="ltr" class="FM_Body">And finally, there is some cleanup code:</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>ASFileSysReleasePath (ASGetDefaultFileSys(), asPathName);</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>PDPageRelease(pdPageImage);<span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span></p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>return formXObject;</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>}</p>
  <p dir="ltr" class="FM_4Head"><a name="TOC_Setting_the_activation"></a><a name="XREF_16449_Setting_the"></a>Setting the activation dictionary</p>
  <p dir="ltr" class="FM_Body">The optional <span class="FM_Courier">3DA</span>&#160;entry of the 3D annotation specifies an <span class="FM_Italic">activation dictionary</span>&#160;whose entries indicate when the annotation should be activated and deactivated and the state of the 3D content at these times. </p>
  <p dir="ltr" class="FM_Body">When an annotation is inactive, it displays its normal appearance. (See <a href="#XREF_59797_Setting_the"><span class="FM_HyperText">Setting the annotation appearance</span></a>.) When it is activated, one of its views (specified by the <span class="FM_Courier">3DV</span>&#160;entry) is displayed. </p>
  <p dir="ltr" class="FM_Body">First the dictionary is created and set as the <span class="FM_Courier">3DA</span> entry of the 3D annotation:</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosObj activationDict = CosNewDict(CosObjGetDoc(cosAnnot), false, 1);</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDictPutKeyString (cosAnnot, &quot;3DA&quot;, activationDict);</p>
  <p dir="ltr" class="FM_Body">It is not necessary to set any entries whose default values are acceptable. Here the non-default entries are set.</p>
  <p dir="ltr" class="FM_Body">The <span class="FM_Courier">DIS</span>&#160;entry of the activation dictionary specifies the state of the 3D content when it is deactivated. In this case, it is set to <span class="FM_Courier">I</span>, meaning that it should be instantiated. (The default is <span class="FM_Courier">U</span> for uninstantiated.)</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDictPutKeyString (activationDict, &quot;DIS&quot;, </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosNewNameFromString (cosDoc, false, &quot;I&quot;));</p>
  <p dir="ltr" class="FM_Body">The code provides a variable to determine the value of the <span class="FM_Courier">A</span>&#160;entry. The default value is <span class="FM_Courier">XA</span>, meaning that the annotation needs to be explicitly activated. <span class="FM_Courier">PO</span>&#160;means that the annotation should be activated as soon as the page containing the annotation is opened:</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>// Optional activation choice</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>if(gbShowDefaultViewWhenOpenPage == true)</p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosDictPutKeyString(activationDict, &quot;A&quot;, </p>
  <p dir="ltr" class="FM_CodeReference"><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span><span style="font-family:'Times New Roman'; font-size:7.0pt">&nbsp;&nbsp;&nbsp;</span>CosNewNameFromString (cosDoc, false, &quot;PO&quot;));</p>
 </div>
<!-- Body place holder ends here-->

    <!-- Footer place holder starts here-->
    <div style="padding:0.4em 0;text-align:center;width:100%;position:relative;">
    	<hr/>
		<p style="font-size:0.7em;margin:0; font-family:adobe-clean, sans-serif"><a target="_blank" href="http://help.adobe.com/en_US/legalnotices/index.html">Legal Notices</a> | <a target="_blank" href="http://www.adobe.com/privacy.html">Online Privacy Policy</a></p>
	</div>
	<!-- Footer place holder ends here-->

</body>
</html>